<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="UTF-8" />
    <title>ÁôªÂΩï</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="stylesheet" href="https://unpkg.com/amis@beta/sdk/sdk.css">
    </link>
    <link rel="stylesheet" href="https://unpkg.com/amis@beta/sdk/helper.css">
    </link>
    <link rel="stylesheet" href="https://unpkg.com/amis@beta/sdk/iconfont.css">
    </link>

    <!-- ËøôÊòØÈªòËÆ§‰∏ªÈ¢òÊâÄÈúÄÁöÑÔºåÂ¶ÇÊûúÊòØÂÖ∂‰ªñ‰∏ªÈ¢òÂàô‰∏çÈúÄË¶Å -->
    <!-- ‰ªé 1.1.0 ÂºÄÂßã sdk.css Â∞Ü‰∏çÊîØÊåÅ IE 11ÔºåÂ¶ÇÊûúË¶ÅÊîØÊåÅ IE11 ËØ∑ÂºïÁî®Ëøô‰∏™ cssÔºåÂπ∂ÊääÂâçÈù¢ÈÇ£‰∏™Âà†‰∫Ü -->
    <!-- <link rel="stylesheet" href="sdk-ie11.css" /> -->
    <!-- ‰∏çËøá amis ÂºÄÂèëÂõ¢ÈòüÂá†‰πéÊ≤°ÊµãËØïËøá IE 11 ‰∏ãÁöÑÊïàÊûúÔºåÊâÄ‰ª•ÂèØËÉΩÊúâÁªÜËäÇÂäüËÉΩÁî®‰∏ç‰∫ÜÔºåÂ¶ÇÊûúÂèëÁé∞ËØ∑Êä• issue -->
    <style>
      html,
      body,
      .app-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .login-form {
        position: absolute;
        top: 50%;
        right: 160px;
        transform: translateY(-60%);
        width: 300px;
      }

    </style>
    <script src="https://unpkg.com/amis@beta/sdk/sdk.js"></script>
    <script src="https://unpkg.com/axios"></script>
    <script>
      (function() {
        if (localStorage.getItem('token')) {
          location.href = '../'
        }
      })()
    </script>
  </head>

  <body>
    <div id="root" class="app-wrapper"></div>
    <script>
      const API_URL = "http://localhost:7070/admin";
      (function() {
        let amis = amisRequire('amis/embed');
        const match = amisRequire('path-to-regexp').match;
        // axios Â∞ÅË£Ö
        const http = axios.create({
          baseURL: API_URL,
          timeout: 5000,
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const app = {
          type: "page",
          label: '111',
          style: {
            background: 'url(https://yingyu.zoulaizouqu.cn/admin/assets/login-bg.d74d55c1.jpg) no-repeat ',
            backgroundSize: 'cover',
            backgroundPosition: 'center'
          },
          body: {
            type: "container",
            className: 'login-form',
            body: {
              title: {
                type: 'tpl',
                tpl: '<span style="font-size:30px">ÁôªÂΩï</span>'
              },
              type: "form",
              api: {
                method: 'post',
                url: `${API_URL}/login`,
                adaptor: function(payload, response) {
                  if (payload.status == 0) {
                    localStorage.setItem('token', payload.data.token);
                  }
                  return payload
                }
              },
              messages: {
                saveSuccess: 'ÁôªÂΩïÊàêÂäü',
                saveFailed: 'ÁôªÂΩïÂ§±Ë¥•',
                fetchFailed: 'Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•'
              },
              body: [
                {
                  type: 'input-text',
                  name: 'username',
                  placeholder: 'ËØ∑ËæìÂÖ•Ë¥¶Âè∑',
                  "prefix": "üôç",
                },
                {
                  type: 'input-password',
                  name: 'password',
                  placeholder: 'ËØ∑ËæìÂÖ•ÂØÜÁ†Å',
                  "prefix": "üîí"
                }
              ],
              actions: [
                {
                  type: 'submit',
                  level: 'primary',
                  label: "ÁôªÂΩï",
                  "actionType": "ajax",
                  "redirect": "/"
                }
              ]
            }
          }
        };

        let amisInstance = amis.embed(
          '#root',
          app,
          {},
          {
            fetcher: ({
              url, // Êé•Âè£Âú∞ÂùÄ
              method, // ËØ∑Ê±ÇÊñπÊ≥ï get„ÄÅpost„ÄÅput„ÄÅdelete
              data, // ËØ∑Ê±ÇÊï∞ÊçÆ
              responseType,
              config, // ÂÖ∂‰ªñÈÖçÁΩÆ
              headers // ËØ∑Ê±ÇÂ§¥
            }) => {
              config = config || {};
              config.withCredentials = true;
              responseType && (config.responseType = responseType);
              if (config.cancelExecutor) {
                config.cancelToken = new axios.CancelToken(
                  config.cancelExecutor
                );
              }

              config.headers = headers || {};

              if (method !== 'post' && method !== 'put' && method !== 'patch') {
                if (data) {
                  config.params = data;
                }
                return http[method](url, config);
              } else if (data && data instanceof FormData) {
                config.headers = config.headers || {};
                config.headers['Content-Type'] = 'multipart/form-data';
              } else if (
                data &&
                typeof data !== 'string' &&
                !(data instanceof Blob) &&
                !(data instanceof ArrayBuffer)
              ) {
                data = JSON.stringify(data);
                config.headers = config.headers || {};
                config.headers['Content-Type'] = 'application/json';
              }

              return http[method](url, data, config);
            },
          }
        );
      })();
    </script>
  </body>

</html>
